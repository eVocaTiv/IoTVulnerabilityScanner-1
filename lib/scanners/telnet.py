import telnetlib
from .scanner import ProtocolScanner
import socket


class TelnetScanner(ProtocolScanner):

    def __init__(self, protocolName, portNumber, IPAddress):
        super(TelnetScanner, self).__init__(protocolName, portNumber, IPAddress)

    def verifyCredentials(self, credentials):
        try:
            telnet = telnetlib.Telnet(str(self.IPAddress), int(self.portNumber))
            telnet.read_until("login: ")
            telnet.write(credentials.getUsername() + "\n")

            if self.password:
                telnet.read_until("Password: ")
                telnet.write(credentials.getPassword() + "\n")

            telnet.write("exit\n")
            return True

        except Exception as e:
            print("Exception in telnet: ", str(e))
            return False